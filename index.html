<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystic Tarot Web App</title>

    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="신비한 타로">
    <link rel="manifest" href="./manifest.json">

    <meta name="apple-mobile-web-app-orientations" content="portrait">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="msapplication-TileColor" content="#4f46e5">
    <meta name="msapplication-config" content="browserconfig.xml">
    <meta name="application-name" content="신비한 타로">
    <meta name="msapplication-tooltip" content="타로 카드 앱">
    <meta name="msapplication-starturl" content="/tarot/">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Lora:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Gowun Dodum', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }

        .app-title {
            font-family: 'Lora', serif;
            font-weight: 700;
        }

        .screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            transition: opacity 0.5s ease-in-out;
            position: relative;
        }

        .card {
            background: linear-gradient(145deg, #4f46e5, #312e81);
            border: 2px solid #6366f1;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            perspective: 1000px;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .card-back {
            background: linear-gradient(145deg, #4f46e5, #312e81);
            border: 2px solid #6366f1;
        }

        .card-back-design {
            width: 70%;
            height: 90%;
            border: 2px dashed #a5b4fc;
            border-radius: 0.25rem;
        }

        .card-front {
            background-color: #f1f5f9;
            color: #1e293b;
            transform: rotateY(180deg);
            padding: 0.5rem;
            flex-direction: column;
            justify-content: space-between;
            text-align: center;
        }

        .card-image {
            width: 100%;
            height: 78%;
            object-fit: contain;
        }

        .card-front.reversed .card-image {
            transform: rotate(180deg);
        }

        .card-name {
            font-family: 'Lora', serif;
            font-weight: bold;
            font-size: 0.7rem;
            padding-top: 0.25rem;
            flex-shrink: 0;
        }

        @media (min-width: 640px) {
            .card-name {
                font-size: 0.875rem;
            }
        }

        .card-grid .card.selected {
            transform: translateY(-10px) scale(1.05);
            border-color: #facc15;
            box-shadow: 0 8px 30px rgba(250, 204, 21, 0.4);
        }

        .selection-number {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #facc15;
            color: #4338ca;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.875rem;
            border: 2px solid #fff;
        }

        .action-btn {
            background-color: #4f46e5;
            color: white;
            padding: 1rem 2rem;
            border-radius: 9999px;
            font-size: 1.125rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border: 2px solid #6366f1;
        }

        .action-btn:hover {
            background-color: #6366f1;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .action-btn:disabled {
            background-color: #475569;
            cursor: not-allowed;
            opacity: 0.7;
            border-color: #64748b;
        }

        .secondary-btn {
            background-color: transparent;
            border: 2px solid #6366f1;
            color: #a5b4fc;
            padding: 0.75rem 1.5rem;
        }

        .secondary-btn:hover {
            background-color: #4338ca;
            border-color: #818cf8;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .modal-content {
            background-color: #1e293b;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .copyright-link {
            color: #64748b;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .copyright-link:hover {
            color: #94a3b8;
        }

        .copyright-notice {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background-color: rgba(15, 23, 42, 0.8);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            backdrop-filter: blur(4px);
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-200">

    <div id="app">

        <section id="deck-selection-screen" class="screen">
            <div class="text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-4 app-title text-amber-300">카드 덱을 선택하세요</h2>
                <p class="text-slate-400 mb-12 text-lg">어떤 카드로 운명을 점쳐보시겠어요?</p>
                <div class="space-y-4 flex flex-col items-center">
                    <button onclick="selectDeck('major')" class="action-btn w-64">메이저 아르카나 (22장)</button>
                    <button onclick="selectDeck('full')" class="action-btn w-64">전체 카드 (78장)</button>
                </div>

                <div class="mt-8 text-center">
                    <p class="text-xs text-slate-400">
                        <a href="https://www.flaticon.com/kr/free-icons/" title="타로 아이콘" class="copyright-link">타로 아이콘
                            제작자:
                            Smashicons - Flaticon</a>
                    </p>
                </div>
            </div>
        </section>

        <section id="count-selection-screen" class="screen hidden">
            <div class="text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-4 app-title text-amber-300">카드 개수를 선택하세요</h2>
                <p class="text-slate-400 mb-8 text-lg">몇 장의 카드를 뽑으시겠어요?</p>
                <div class="space-y-4 flex flex-col items-center mb-8">
                    <button onclick="startGame(1)" class="action-btn w-64">한 장 뽑기</button>
                    <button onclick="startGame(3)" class="action-btn w-64">세 장 뽑기</button>
                    <button onclick="showCustomInput()" class="action-btn w-64">원하는 개수 뽑기</button>
                </div>
                <button onclick="showDeckSelection()" class="action-btn secondary-btn">뒤로가기</button>

                <div class="mt-8 text-center">
                    <p class="text-xs text-slate-400">
                        <a href="https://www.flaticon.com/kr/free-icons/" title="타로 아이콘" class="copyright-link">타로 아이콘
                            제작자: Smashicons - Flaticon</a>
                    </p>
                </div>
            </div>
        </section>

        <section id="selection-screen" class="screen hidden">
            <div class="container mx-auto text-center">
                <div class="flex justify-center gap-4 mb-8">
                    <button onclick="showCountSelection()" class="action-btn secondary-btn">뒤로가기</button>
                    <button id="view-results-btn" class="action-btn" onclick="showResults()" disabled>결과 보기</button>
                </div>
                <h2 id="selection-title" class="text-3xl md:text-4xl font-bold mb-2 app-title text-amber-300">카드를 선택하세요
                </h2>
                <p id="selection-subtitle" class="text-slate-400 mb-8">남은 카드: <span id="cards-left-count"></span></p>
                <div id="card-grid"
                    class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 xl:grid-cols-13 gap-2 md:gap-4 max-w-7xl mx-auto mb-8">
                </div>

                <div class="mt-4 text-center">
                    <p class="text-xs text-slate-400">
                        <a href="https://www.flaticon.com/kr/free-icons/" title="타로 아이콘" class="copyright-link">타로 아이콘
                            제작자: Smashicons - Flaticon</a>
                    </p>
                </div>
            </div>
        </section>

        <section id="result-screen" class="screen hidden">
            <div class="container mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-8 app-title text-amber-300">당신의 운명</h2>
                <div id="result-cards" class="flex flex-wrap justify-center items-start gap-4 md:gap-8 mb-8">
                </div>
                <div id="card-interpretation"
                    class="max-w-2xl mx-auto bg-slate-800 p-6 rounded-lg min-h-[150px] text-left shadow-lg hidden">
                    <h3 id="interp-title" class="text-2xl font-bold text-amber-300 mb-2 app-title"></h3>
                    <p id="interp-text" class="text-slate-300"></p>
                </div>
                <button onclick="resetGame()" class="action-btn mt-8 secondary-btn">처음으로 돌아가기</button>

                <div class="copyright-notice">
                    <p class="text-xs text-slate-500">
                        <a href="https://www.flaticon.com/kr/free-icons/" title="타로 아이콘" class="copyright-link">타로 아이콘
                            제작자: Smashicons - Flaticon</a>
                    </p>
                </div>
            </div>
        </section>

    </div>

    <div id="custom-input-modal" class="modal-backdrop hidden">
        <div class="modal-content text-center">
            <h3 class="text-2xl font-bold mb-4 app-title text-amber-300">몇 장을 뽑으시겠어요?</h3>
            <p id="custom-input-description" class="text-slate-400 mb-6">(1~78 사이의 숫자를 입력하세요)</p>
            <input type="number" id="custom-card-count"
                class="bg-slate-700 text-white text-center text-2xl w-32 p-2 rounded-lg border-2 border-indigo-500 focus:border-amber-400 focus:outline-none"
                min="1" max="78">
            <div class="mt-6 flex justify-center gap-4">
                <button onclick="startCustomGame()" class="action-btn px-8 py-3">확인</button>
                <button onclick="hideCustomInput()" class="action-btn secondary-btn px-8 py-3">취소</button>
            </div>
        </div>
    </div>

    <div id="alert-modal" class="modal-backdrop hidden">
        <div class="modal-content text-center">
            <h3 class="text-2xl font-bold mb-4 app-title text-amber-300">알림</h3>
            <p id="alert-text" class="text-slate-400 mb-6"></p>
            <div class="mt-6 flex justify-center gap-4">
                <button onclick="hideAlert()" class="action-btn px-8 py-3">확인</button>
            </div>
        </div>
    </div>

    <script>
        const tarotDeckData = [
            { name: '바보', image: 'cards/major/0. 바보 카드.jpg', meaning_up: '순수, 새로운 시작, 자유, 미지의 가능성', meaning_rev: '무모함, 어리석음, 부주의, 위험' },
            { name: '마법사', image: 'cards/major/1. 마법사 카드.jpg', meaning_up: '창조, 의지, 재능, 능력', meaning_rev: '기만, 속임수, 재능 남용, 조작' },
            { name: '여사제', image: 'cards/major/2. 여사제 카드.jpg', meaning_up: '직관, 지혜, 비밀, 내면의 목소리', meaning_rev: '숨겨진 진실, 무지, 피상적임' },
            { name: '여황제', image: 'cards/major/3. 여황제 카드.jpg', meaning_up: '풍요, 다산, 모성애, 아름다움', meaning_rev: '과잉, 의존, 창의력 부족' },
            { name: '황제', image: 'cards/major/4. 황제 카드.jpg', meaning_up: '권위, 통제, 리더십, 안정', meaning_rev: '독재, 지배, 완고함, 억압' },
            { name: '교황', image: 'cards/major/5. 교황 카드.jpg', meaning_up: '전통, 신념, 교육, 정신적 지도자', meaning_rev: '인습 타파, 위선, 편협함' },
            { name: '연인', image: 'cards/major/6. 연인 카드.jpg', meaning_up: '사랑, 관계, 조화, 선택', meaning_rev: '불화, 잘못된 선택, 관계의 균열' },
            { name: '전차', image: 'cards/major/7. 전차 카드.jpg', meaning_up: '승리, 의지력, 전진, 통제', meaning_rev: '패배, 방향 상실, 통제 불능' },
            { name: '힘', image: 'cards/major/8. 힘 카드.jpg', meaning_up: '용기, 인내, 내면의 힘, 부드러운 통제', meaning_rev: '나약함, 자기 의심, 억압된 분노' },
            { name: '은둔자', image: 'cards/major/9. 은둔자 카드.jpg', meaning_up: '성찰, 내면 탐구, 지혜, 고독', meaning_rev: '고립, 외로움, 지혜의 부족' },
            { name: '운명의 수레바퀴', image: 'cards/major/10. 운명의 수레바퀴.jpg', meaning_up: '변화, 운명, 전환점, 행운', meaning_rev: '불운, 저항, 정체' },
            { name: '정의', image: 'cards/major/11. 정의 카드.jpg', meaning_up: '공정, 균형, 진실, 법', meaning_rev: '불공정, 편견, 불균형' },
            { name: '매달린 남자', image: 'cards/major/12. 행맨 카드.jpg', meaning_up: '희생, 새로운 관점, 인내, 기다림', meaning_rev: '헛된 희생, 정체, 무의미한 기다림' },
            { name: '죽음', image: 'cards/major/13. 죽음 카드.jpg', meaning_up: '끝, 변화, 전환, 새로운 시작', meaning_rev: '변화에 대한 저항, 정체, 두려움' },
            { name: '절제', image: 'cards/major/14. 절제 카드.jpg', meaning_up: '균형, 조화, 인내, 중용', meaning_rev: '불균형, 과잉, 극단' },
            { name: '악마', image: 'cards/major/15. 악마 카드.jpg', meaning_up: '속박, 중독, 물질주의, 유혹', meaning_rev: '속박에서의 해방, 자유, 자각' },
            { name: '탑', image: 'cards/major/16. 타워 카드.jpg', meaning_up: '급작스러운 변화, 파괴, 재앙, 진실의 발견', meaning_rev: '파괴를 피함, 점진적인 변화, 위기' },
            { name: '별', image: 'cards/major/17. 별 카드.jpg', meaning_up: '희망, 영감, 치유, 평온', meaning_rev: '절망, 실망, 희망의 상실' },
            { name: '달', image: 'cards/major/18. 달 카드.jpg', meaning_up: '불안, 환상, 직관, 무의식', meaning_rev: '혼란 해소, 진실 발견, 두려움 극복' },
            { name: '태양', image: 'cards/major/19. 태양 카드.jpg', meaning_up: '성공, 기쁨, 활력, 명료함', meaning_rev: '일시적인 슬픔, 자신감 부족, 비관' },
            { name: '심판', image: 'cards/major/20. 심판 카드.jpg', meaning_up: '부활, 깨달음, 용서, 새로운 시작', meaning_rev: '자기 비판, 과거에 대한 후회, 기회 놓침' },
            { name: '세계', image: 'cards/major/21. 세계 카드.jpg', meaning_up: '완성, 성취, 통합, 여행', meaning_rev: '미완성, 정체, 목표 달성 실패' },
            { name: '완드 1', image: 'cards/wand/완드 에이스.jpg', meaning_up: '창의성, 새로운 시작, 영감, 잠재력', meaning_rev: '기회의 상실, 시작의 어려움, 방향성 부족' },
            { name: '완드 2', image: 'cards/wand/완드2.jpg', meaning_up: '계획, 결정, 미래 준비, 파트너십', meaning_rev: '두려움, 우유부단함, 잘못된 선택' },
            { name: '완드 3', image: 'cards/wand/완드3.jpg', meaning_up: '확장, 성장, 장기적인 계획, 탐험', meaning_rev: '지연, 장애물, 비현실적인 계획' },
            { name: '완드 4', image: 'cards/wand/완드4.jpg', meaning_up: '축하, 안정, 조화, 가정', meaning_rev: '불안정, 불화, 축하의 지연' },
            { name: '완드 5', image: 'cards/wand/완드5.jpg', meaning_up: '갈등, 경쟁, 다툼, 도전', meaning_rev: '갈등 해소, 협력, 타협' },
            { name: '완드 6', image: 'cards/wand/완드6.jpg', meaning_up: '승리, 성공, 인정, 자신감', meaning_rev: '패배, 오만, 인정받지 못함' },
            { name: '완드 7', image: 'cards/wand/완드7.jpg', meaning_up: '방어, 용기, 도전, 자신의 입장 고수', meaning_rev: '압도당함, 포기, 나약함' },
            { name: '완드 8', image: 'cards/wand/완드8.jpg', meaning_up: '빠른 진행, 소식, 행동, 변화', meaning_rev: '지연, 장애물, 잘못된 소식' },
            { name: '완드 9', image: 'cards/wand/완드9.jpg', meaning_up: '인내, 경계, 방어적인 태세, 회복력', meaning_rev: '피로, 포기, 방어 실패' },
            { name: '완드 10', image: 'cards/wand/완드10.jpg', meaning_up: '부담, 책임감, 과로, 압박', meaning_rev: '부담 내려놓기, 책임 회피, 붕괴' },
            { name: '완드 시종', image: 'cards/wand/완드 페이지.jpg', meaning_up: '열정, 새로운 아이디어, 탐험, 자유로운 영혼', meaning_rev: '미성숙, 충동성, 방향성 상실' },
            { name: '완드 기사', image: 'cards/wand/완드 나이트.jpg', meaning_up: '행동, 모험, 열정, 충동', meaning_rev: '무모함, 성급함, 좌절' },
            { name: '완드 여왕', image: 'cards/wand/완드 퀸.jpg', meaning_up: '자신감, 독립, 활기, 매력', meaning_rev: '질투, 이기심, 지배욕' },
            { name: '완드 왕', image: 'cards/wand/완드 킹.jpg', meaning_up: '리더십, 비전, 카리스마, 창의력', meaning_rev: '독재, 편협함, 통제 불능' },
            { name: '컵 1', image: 'cards/cup/컵 에이스.jpg', meaning_up: '새로운 감정, 사랑의 시작, 직관, 창의성', meaning_rev: '감정적 공허함, 억압된 감정, 사랑의 거부' },
            { name: '컵 2', image: 'cards/cup/컵2.jpg', meaning_up: '사랑, 파트너십, 조화, 연결', meaning_rev: '불화, 관계의 균열, 이별' },
            { name: '컵 3', image: 'cards/cup/컵3.jpg', meaning_up: '축하, 우정, 사교, 즐거움', meaning_rev: '과도한 쾌락, 고립, 불화' },
            { name: '컵 4', image: 'cards/cup/컵4.jpg', meaning_up: '권태, 무관심, 불만, 성찰', meaning_rev: '새로운 기회, 활력, 정체 탈출' },
            { name: '컵 5', image: 'cards/cup/컵5.jpg', meaning_up: '상실, 슬픔, 후회, 실망', meaning_rev: '과거 극복, 용서, 새로운 희망' },
            { name: '컵 6', image: 'cards/cup/컵6.jpg', meaning_up: '추억, 순수, 과거의 선물, 향수', meaning_rev: '과거에 얽매임, 현실 도피, 미성숙' },
            { name: '컵 7', image: 'cards/cup/컵7.jpg', meaning_up: '환상, 선택, 상상, 꿈', meaning_rev: '현실 직시, 결단력, 환상에서 깨어남' },
            { name: '컵 8', image: 'cards/cup/컵8.jpg', meaning_up: '떠남, 탐색, 감정적 여정, 변화', meaning_rev: '두려움 때문에 떠나지 못함, 정체, 불만족스러운 현실' },
            { name: '컵 9', image: 'cards/cup/컵9.jpg', meaning_up: '소원 성취, 만족, 행복, 풍요', meaning_rev: '불만족, 탐욕, 실망' },
            { name: '컵 10', image: 'cards/cup/컵10.jpg', meaning_up: '행복한 가정, 조화, 만족, 사랑', meaning_rev: '가정 불화, 불행, 깨진 꿈' },
            { name: '컵 시종', image: 'cards/cup/컵 페이지.jpg', meaning_up: '창의적인 메시지, 직관, 감수성, 꿈', meaning_rev: '감정적 미성숙, 창의력 부족, 현실 도피' },
            { name: '컵 기사', image: 'cards/cup/컵 나이트.jpg', meaning_up: '로맨스, 매력, 이상주의, 감정적 제안', meaning_rev: '감정적 조작, 변덕, 비현실적' },
            { name: '컵 여왕', image: 'cards/cup/컵 퀸.jpg', meaning_up: '공감, 직관, 사랑, 치유', meaning_rev: '감정적 불안정, 의존, 자기 연민' },
            { name: '컵 왕', image: 'cards/cup/컵 킹.jpg', meaning_up: '감정적 성숙, 통제, 지혜, 관용', meaning_rev: '감정적 조작, 변덕, 냉담함' },
            { name: '소드 1', image: 'cards/sword/소드 에이스.jpg', meaning_up: '새로운 아이디어, 진실, 명료함, 돌파구', meaning_rev: '혼란, 잘못된 판단, 거짓' },
            { name: '소드 2', image: 'cards/sword/소드2.jpg', meaning_up: '교착 상태, 어려운 결정, 평화 유지', meaning_rev: '결정, 진실을 마주함, 혼란' },
            { name: '소드 3', image: 'cards/sword/소드3.jpg', meaning_up: '상처, 슬픔, 이별, 진실의 고통', meaning_rev: '치유, 용서, 고통 극복' },
            { name: '소드 4', image: 'cards/sword/소드4.jpg', meaning_up: '휴식, 회복, 명상, 평온', meaning_rev: '정체, 고립, 회복의 필요성' },
            { name: '소드 5', image: 'cards/sword/소드5.jpg', meaning_up: '갈등, 패배, 이기적인 승리, 불명예', meaning_rev: '화해, 타협, 갈등의 끝' },
            { name: '소드 6', image: 'cards/sword/소드6.jpg', meaning_up: '이동, 전환, 슬픔 속의 전진, 도움', meaning_rev: '정체, 변화에 대한 저항, 어려움' },
            { name: '소드 7', image: 'cards/sword/소드7.jpg', meaning_up: '기만, 속임수, 전략, 혼자 행동함', meaning_rev: '진실의 폭로, 양심의 가책, 조언을 구함' },
            { name: '소드 8', image: 'cards/sword/소드8.jpg', meaning_up: '속박, 제한, 자기 의심, 무력감', meaning_rev: '해방, 자기 의심 극복, 자유' },
            { name: '소드 9', image: 'cards/sword/소드9.jpg', meaning_up: '불안, 걱정, 악몽, 죄책감', meaning_rev: '두려움 극복, 희망, 도움을 받음' },
            { name: '소드 10', image: 'cards/sword/소드10.jpg', meaning_up: '실패, 끝, 배신, 고통스러운 결말', meaning_rev: '회복, 새로운 시작, 과거를 뒤로 함' },
            { name: '소드 시종', image: 'cards/sword/소드 페이지.jpg', meaning_up: '호기심, 새로운 소식, 진실 탐구, 재치', meaning_rev: '가십, 거짓말, 방어적인 태도' },
            { name: '소드 기사', image: 'cards/sword/소드 나이트.jpg', meaning_up: '단호함, 빠른 생각, 행동, 야망', meaning_rev: '무모함, 공격성, 성급한 판단' },
            { name: '소드 여왕', image: 'cards/sword/소드 퀸.jpg', meaning_up: '지성, 독립, 명료함, 정직', meaning_rev: '냉담함, 비판적, 고독' },
            { name: '소드 왕', image: 'cards/sword/소드 킹.jpg', meaning_up: '권위, 지성, 진실, 공정함', meaning_rev: '냉혹함, 독재, 판단력 부족' },
            { name: '펜타클 1', image: 'cards/pentacle/펜타클 에이스.jpg', meaning_up: '새로운 기회, 풍요, 현실적인 시작, 번영', meaning_rev: '놓친 기회, 잘못된 투자, 불안정한 시작' },
            { name: '펜타클 2', image: 'cards/pentacle/펜타클2.jpg', meaning_up: '균형, 적응, 우선순위 정하기, 변화', meaning_rev: '불균형, 무질서, 잘못된 결정' },
            { name: '펜타클 3', image: 'cards/pentacle/펜타클3.jpg', meaning_up: '협력, 팀워크, 기술, 인정', meaning_rev: '협력 부족, 기술 부족, 평범함' },
            { name: '펜타클 4', image: 'cards/pentacle/펜타클4.jpg', meaning_up: '소유, 안정, 통제, 보수성', meaning_rev: '탐욕, 손실에 대한 두려움, 정체' },
            { name: '펜타클 5', image: 'cards/pentacle/펜타클5.jpg', meaning_up: '궁핍, 고난, 외로움, 소외', meaning_rev: '회복, 도움, 역경 극복' },
            { name: '펜타클 6', image: 'cards/pentacle/펜타클6.jpg', meaning_up: '관대함, 자선, 나눔, 도움', meaning_rev: '부채, 이기심, 불공정한 거래' },
            { name: '펜타클 7', image: 'cards/pentacle/펜타클7.jpg', meaning_up: '인내, 장기적인 계획, 투자, 성찰', meaning_rev: '조급함, 노력의 부족, 실망' },
            { name: '펜타클 8', image: 'cards/pentacle/펜타클8.jpg', meaning_up: '장인 정신, 기술 연마, 노력, 집중', meaning_rev: '게으름, 기술 부족, 완벽주의' },
            { name: '펜타클 9', image: 'cards/pentacle/펜타클9.jpg', meaning_up: '독립, 풍요, 자기만족, 성공', meaning_rev: '물질적 손실, 의존, 불안' },
            { name: '펜타클 10', image: 'cards/pentacle/펜타클10.jpg', meaning_up: '유산, 부, 안정된 가정, 전통', meaning_rev: '가족 갈등, 재정적 손실, 불안정' },
            { name: '펜타클 시종', image: 'cards/pentacle/펜타클 페이지.jpg', meaning_up: '새로운 기회, 학구열, 실용적인 계획, 꿈', meaning_rev: '게으름, 기회 놓침, 미성숙' },
            { name: '펜타클 기사', image: 'cards/pentacle/펜타클 나이트.jpg', meaning_up: '성실, 책임감, 꾸준함, 노력', meaning_rev: '정체, 게으름, 완고함' },
            { name: '펜타클 여왕', image: 'cards/pentacle/펜타클 퀸.jpg', meaning_up: '현실성, 풍요, 안정, 따뜻함', meaning_rev: '물질주의, 불안, 질투' },
            { name: '펜타클 왕', image: 'cards/pentacle/펜타클 킹.jpg', meaning_up: '성공, 부, 안정, 리더십', meaning_rev: '탐욕, 부패, 무능' },
        ];

        let state = {
            currentScreen: 'deck-selection-screen',
            cardsToDraw: 0,
            selectedCards: [],
            fullDeck: [],
            selectedDeck: null, // 'major' or 'full'
        };

        const screens = {
            'deck-selection': document.getElementById('deck-selection-screen'),
            'count-selection': document.getElementById('count-selection-screen'),
            'selection': document.getElementById('selection-screen'),
            'result': document.getElementById('result-screen'),
        };

        const elements = {
            cardGrid: document.getElementById('card-grid'),
            cardsLeftCount: document.getElementById('cards-left-count'),
            viewResultsBtn: document.getElementById('view-results-btn'),
            resultCards: document.getElementById('result-cards'),
            interpretationBox: document.getElementById('card-interpretation'),
            interpTitle: document.getElementById('interp-title'),
            interpText: document.getElementById('interp-text'),
            customInputModal: document.getElementById('custom-input-modal'),
            customCardCountInput: document.getElementById('custom-card-count'),
            customInputDescription: document.getElementById('custom-input-description'),
            selectionTitle: document.getElementById('selection-title'),
            selectionSubtitle: document.getElementById('selection-subtitle'),
            alertModal: document.getElementById('alert-modal'),
            alertText: document.getElementById('alert-text'),
        };

        // DOM 요소들이 제대로 로드되었는지 확인
        function checkElements() {
            const missingElements = [];
            Object.entries(elements).forEach(([key, element]) => {
                if (!element) {
                    missingElements.push(key);
                }
            });
            if (missingElements.length > 0) {
                console.error('Missing DOM elements:', missingElements);
            }
        }

        function showScreen(screenId) {
            Object.values(screens).forEach(screen => {
                if (screen) {
                    screen.classList.add('hidden', 'opacity-0');
                }
            });
            const activeScreen = screens[screenId];
            if (activeScreen) {
                activeScreen.classList.remove('hidden');
                setTimeout(() => activeScreen.classList.remove('opacity-0'), 50);
                state.currentScreen = screenId;
            }
        }

        function showDeckSelection() {
            showScreen('deck-selection');
        }

        function selectDeck(deckType) {
            state.selectedDeck = deckType;
            showScreen('count-selection');
        }

        function showCountSelection() {
            showScreen('count-selection');
        }

        function showAlert(message) {
            if (elements.alertText && elements.alertModal) {
                elements.alertText.textContent = message;
                elements.alertModal.classList.remove('hidden');
            } else {
                console.error('Alert elements not found');
                alert(message); // Fallback to native alert
            }
        }

        function hideAlert() {
            if (elements.alertModal) {
                elements.alertModal.classList.add('hidden');
            }
        }

        function shuffleDeck(deck) {
            let shuffled = [...deck];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function updateSelectionCount() {
            const cardsLeft = state.cardsToDraw - state.selectedCards.length;
            
            if (elements.cardsLeftCount) {
                elements.cardsLeftCount.textContent = cardsLeft;
            }
            
            if (elements.viewResultsBtn) {
                elements.viewResultsBtn.disabled = cardsLeft !== 0;
            }

            if (elements.selectionSubtitle) {
                if (cardsLeft === 0) {
                    elements.selectionSubtitle.innerHTML = '모든 카드를 선택했습니다. 결과 보기를 눌러주세요.';
                } else {
                    elements.selectionSubtitle.innerHTML = `남은 카드: <span id="cards-left-count">${cardsLeft}</span>`;
                }
            }
        }

        function updateSelectionNumbers() {
            document.querySelectorAll('.selection-number').forEach(num => num.remove());
            state.selectedCards.forEach((card, index) => {
                const cardEl = document.querySelector(`[data-card-id='${card.id}']`);
                if (cardEl) {
                    const numberEl = document.createElement('div');
                    numberEl.className = 'selection-number';
                    numberEl.textContent = index + 1;
                    cardEl.appendChild(numberEl);
                }
            });
        }

        function handleCardSelect(event) {
            const cardEl = event.currentTarget;
            const cardId = parseInt(cardEl.dataset.cardId);

            const isSelected = state.selectedCards.some(card => card.id === cardId);

            if (isSelected) {
                state.selectedCards = state.selectedCards.filter(card => card.id !== cardId);
                cardEl.classList.remove('selected');
            } else {
                if (state.selectedCards.length < state.cardsToDraw) {
                    const cardData = state.fullDeck.find(card => card.id === cardId);
                    state.selectedCards.push(cardData);
                    cardEl.classList.add('selected');
                }
            }
            updateSelectionNumbers();
            updateSelectionCount();
        }

        function populateSelectionGrid() {
            if (!elements.cardGrid) {
                console.error('Card grid element not found');
                return;
            }
            
            elements.cardGrid.innerHTML = '';
            // Shuffle the deck before displaying
            const shuffledDeckForDisplay = shuffleDeck(state.fullDeck);
            shuffledDeckForDisplay.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card rounded-lg aspect-[2/3]';
                cardEl.dataset.cardId = card.id;
                cardEl.innerHTML = `<div class="card-back flex justify-center items-center rounded-lg"><div class="card-back-design"></div></div>`;
                cardEl.addEventListener('click', handleCardSelect);
                elements.cardGrid.appendChild(cardEl);
            });
        }

        function startGame(count) {
            state.cardsToDraw = count;
            state.selectedCards = [];

            // Set the deck based on user selection
            if (state.selectedDeck === 'major') {
                state.fullDeck = tarotDeckData.slice(0, 22).map((card, index) => ({ ...card, id: index }));
            } else {
                state.fullDeck = tarotDeckData.map((card, index) => ({ ...card, id: index }));
            }

            if (elements.selectionTitle) {
                elements.selectionTitle.textContent = `${count}장의 카드를 선택하세요`;
            }

            populateSelectionGrid();
            updateSelectionCount();
            showScreen('selection');
        }

        function showCustomInput() {
            const maxCards = state.selectedDeck === 'major' ? 22 : 78;
            
            if (elements.customInputDescription) {
                elements.customInputDescription.textContent = `(1~${maxCards} 사이의 숫자를 입력하세요)`;
            }
            
            if (elements.customCardCountInput) {
                elements.customCardCountInput.max = maxCards;
                elements.customCardCountInput.value = '';
                elements.customCardCountInput.focus();
            }
            
            if (elements.customInputModal) {
                elements.customInputModal.classList.remove('hidden');
            }
        }

        function hideCustomInput() {
            if (elements.customInputModal) {
                elements.customInputModal.classList.add('hidden');
            }
        }

        function startCustomGame() {
            if (!elements.customCardCountInput) {
                console.error('Custom card count input not found');
                return;
            }
            
            const count = parseInt(elements.customCardCountInput.value);
            const maxCards = state.selectedDeck === 'major' ? 22 : 78;
            
            if (count > 0 && count <= maxCards) {
                hideCustomInput();
                startGame(count);
            } else {
                const message = state.selectedDeck === 'major' 
                    ? '1에서 22 사이의 숫자를 입력해주세요.' 
                    : '1에서 78 사이의 숫자를 입력해주세요.';
                showAlert(message);
            }
        }

        function revealCard(cardEl, cardData) {
            if (cardEl.classList.contains('flipped')) return;

            cardEl.classList.add('flipped');
            const isReversed = Math.random() < 0.5;
            const cardFront = cardEl.querySelector('.card-front');

            if (cardFront) {
                if (isReversed) {
                    cardFront.classList.add('reversed');
                } else {
                    cardFront.classList.remove('reversed');
                }
            }

            if (elements.interpretationBox) {
                elements.interpretationBox.classList.remove('hidden');
            }
            
            if (elements.interpTitle) {
                elements.interpTitle.textContent = `${cardData.name} (${isReversed ? '역방향' : '정방향'})`;
            }
            
            if (elements.interpText) {
                elements.interpText.textContent = isReversed ? cardData.meaning_rev : cardData.meaning_up;
            }

            document.querySelectorAll('#result-cards .card').forEach(c => {
                c.style.borderColor = '#6366f1';
            });
            cardEl.style.borderColor = '#facc15';
        }

        function showResults() {
            if (!elements.resultCards) {
                console.error('Result cards element not found');
                return;
            }
            
            elements.resultCards.innerHTML = '';
            
            if (elements.interpretationBox) {
                elements.interpretationBox.classList.add('hidden');
            }

            state.selectedCards.forEach(cardData => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card rounded-lg w-24 h-36 sm:w-32 sm:h-48 md:w-40 md:h-60';
                cardEl.innerHTML = `
                    <div class="card-inner">
                        <div class="card-face card-back">
                            <div class="card-back-design"></div>
                        </div>
                        <div class="card-face card-front">
                            <img src="${cardData.image}" alt="${cardData.name}" class="card-image">
                            <div class="card-name">${cardData.name}</div>
                        </div>
                    </div>
                `;

                const img = cardEl.querySelector('.card-image');
                if (img) {
                    img.onerror = function () {
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'text-xs text-red-500 p-2 flex items-center justify-center h-full text-center';
                        errorDiv.textContent = `이미지를 불러올 수 없습니다.`;
                        img.parentElement.replaceChild(errorDiv, img);
                    };
                }

                cardEl.addEventListener('click', () => revealCard(cardEl, cardData));
                elements.resultCards.appendChild(cardEl);
            });
            showScreen('result');
        }

        function resetGame() {
            state.cardsToDraw = 0;
            state.selectedCards = [];
            state.selectedDeck = null;
            showScreen('deck-selection');
        }


        document.addEventListener('DOMContentLoaded', () => {
            try {
                console.log('DOM Content Loaded - Initializing Tarot App');
                checkElements();
                showScreen('deck-selection');
                console.log('Initial screen displayed successfully');
            } catch (error) {
                console.error('Error during initialization:', error);
                // Fallback: show a simple message if everything fails
                document.body.innerHTML = '<div style="text-align: center; padding: 50px; color: white; background: #0f172a; min-height: 100vh;"><h1>타로 앱을 불러오는 중 오류가 발생했습니다.</h1><p>페이지를 새로고침해주세요.</p></div>';
            }

            // PWA Service Worker 등록
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./sw.js', {
                        scope: './'
                    })
                        .then((registration) => {
                            console.log('SW registered successfully: ', registration);
                        })
                        .catch((registrationError) => {
                            console.log('SW registration failed: ', registrationError);
                        });
                });
            }
        });

    </script>
</body>

</html>